import{c as J,k as De,l as b,g as z,i as k,F as et,m as Ie,t as Y,n as Fe,P as tt,p as rt,b as Z,d as nt,s as it,r as $e,S as ot,q,o as st,a as lt}from"./web.58b2c6e3.js";import{g as W,H as U,B as G,P as at,s as V,m as ut,a as ft,i as ct,b as ht,c as de,e as dt,d as _t,I as Ce,p as mt,f as pt,h as gt}from"./marked.esm.8e30c4d6.js";/* empty css                       */import{b as wt,c as xt,y as ie,s as yt}from"./alert.13fa34b1.js";var F=(r=>(r.TOGGLE_BOLD="**",r.TOGGLE_ITALIC="_",r.TOOLBAR_HEADING_1="# ",r.TOOLBAR_HEADING_2="## ",r.TOOLBAR_HEADING_3="### ",r.TOOLBAR_HEADING_4="#### ",r.TOOLBAR_HEADING_5="###### ",r.TOOLBAR_HEADING_6="####### ",r))(F||{});function Et({textAreaValue:r,selectionStart:e,selectionEnd:t,action:n}){let i=r,s=[0,0];switch(n){case"**":case"_":{const o=It({text:i,chars:n,selectionEnd:t,selectionStart:e});i=o.text,s=o.selected;break}case"# ":case"## ":case"### ":case"#### ":case"###### ":case"####### ":{let o=e===0?0:e-1,l=!1;for(;!l&&o>0;){if(i.charAt(o)===`
`){o+=1,l=!0;break}o--}let u=i.indexOf(`
`,o);u===-1&&(u=i.length);let f=i.slice(o,u);f.startsWith(n)?f=f.slice(n.length):f.startsWith("#")?f=n.concat(f.slice(f.indexOf(" ")+1)):f=`${n}${f}`,i=i.slice(0,o).concat(f).concat(i.slice(u)),s=[o+f.length,o+f.length];break}}return{text:i,selected:s}}function It({text:r,selectionEnd:e,selectionStart:t,chars:n}){const i=n.length;return r.slice(t-i,t)===n&&r.slice(e,e+i)===n?{text:r.slice(0,t-i).concat(r.slice(t,e)).concat(r.slice(e+i)),selected:[t-i,e-i]}:{text:r.slice(0,t).concat(n).concat(r.slice(t,e)).concat(n).concat(r.slice(e)),selected:[t+i,e+i]}}function Ct(r){const[e,t]=J(Array.isArray(r)?r.map(n=>({buttonText:n.defaultText,buttonTitle:""})):{buttonText:r.defaultText,buttonTitle:""});return De(()=>{Array.isArray(r)?t(r.map(n=>({buttonText:n.defaultText,buttonTitle:W(n)}))):t({buttonText:r.defaultText,buttonTitle:W(r)})}),e}const St=Y('<ul class="headings-list"></ul>'),bt=Y("<li></li>"),Se=[{...U.Heading1,action:F.TOOLBAR_HEADING_1},{...U.Heading2,action:F.TOOLBAR_HEADING_2},{...U.Heading3,action:F.TOOLBAR_HEADING_3},{...U.Heading4,action:F.TOOLBAR_HEADING_4},{...U.Heading5,action:F.TOOLBAR_HEADING_5},{...U.Heading6,action:F.TOOLBAR_HEADING_6}];function vt({onClick:r}){const[e,t]=J({left:"0px",top:"0px"}),[n,i]=J(!1),s=Ct(Se);return[b(G,{variant:"primary",size:"sm",class:"w-8",title:"Headings",onClick:o=>{const l=o.currentTarget.getBoundingClientRect();t({left:`${l.left}px`,top:`${l.top+l.height}px`}),i(!0)},children:"H"}),b(at,{isVisible:n,onClose:()=>{i(!1)},popoverStyle:e,className:"heading-toolbar-popover",get children(){const o=z(St);return k(o,b(et,{get each(){return s()},children:(l,u)=>(()=>{const f=z(bt);return k(f,b(G,{variant:"ghost",size:"sm",onClick:r,get["data-action"](){return Se[u()].action},get children(){return[Ie(()=>l.buttonText)," (",Ie(()=>l.buttonTitle),")"]}})),f})()})),o}})]}const At=Y('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 0V128C224 145.7 238.3 160 256 160H384V448C384 483.3 355.3 512 320 512H64C28.65 512 0 483.3 0 448V64C0 28.65 28.65 0 64 0H224zM80 224C57.91 224 40 241.9 40 264V344C40 366.1 57.91 384 80 384H96C118.1 384 136 366.1 136 344V336C136 327.2 128.8 320 120 320C111.2 320 104 327.2 104 336V344C104 348.4 100.4 352 96 352H80C75.58 352 72 348.4 72 344V264C72 259.6 75.58 256 80 256H96C100.4 256 104 259.6 104 264V272C104 280.8 111.2 288 120 288C128.8 288 136 280.8 136 272V264C136 241.9 118.1 224 96 224H80zM175.4 310.6L200.8 325.1C205.2 327.7 208 332.5 208 337.6C208 345.6 201.6 352 193.6 352H168C159.2 352 152 359.2 152 368C152 376.8 159.2 384 168 384H193.6C219.2 384 240 363.2 240 337.6C240 320.1 231.1 305.6 216.6 297.4L191.2 282.9C186.8 280.3 184 275.5 184 270.4C184 262.4 190.4 256 198.4 256H216C224.8 256 232 248.8 232 240C232 231.2 224.8 224 216 224H198.4C172.8 224 152 244.8 152 270.4C152 287 160.9 302.4 175.4 310.6zM280 240C280 231.2 272.8 224 264 224C255.2 224 248 231.2 248 240V271.6C248 306.3 258.3 340.3 277.6 369.2L282.7 376.9C285.7 381.3 290.6 384 296 384C301.4 384 306.3 381.3 309.3 376.9L314.4 369.2C333.7 340.3 344 306.3 344 271.6V240C344 231.2 336.8 224 328 224C319.2 224 312 231.2 312 240V271.6C312 294.6 306.5 317.2 296 337.5C285.5 317.2 280 294.6 280 271.6V240zM256 0L384 128H256V0z"></path></svg>');function Tt(r){return z(At)}const Rt=Y('<input type="file" class="hidden">');function Ot({textAreaElement:r}){const[e,t]=J(void 0);return[b(G,{variant:"primary",class:"w-8 h-full",size:"sm",title:"Upload CSV",onClick:()=>{e()?.click()},get children(){return b(Tt,{class:"w-4 h-4"})}}),(()=>{const n=z(Rt);return n.addEventListener("change",i=>{const s=new FileReader,o=i.currentTarget.files?.[0];o&&(s.readAsText(o,"utf-8"),s.addEventListener("load",()=>{const l=s.result;if(typeof l!="string")return;const[u,...f]=l.split(`
`);V(h=>{const c=r();if(!c)return h;const{selectionStart:x}=c,y=be(u),m=`| ${y.join(" | ")} |`,p=`| ${y.fill("-").join(" | ")} |`,C=f.map(E=>`| ${be(E).join(" | ")} |`).join(`
`);return h.slice(0,x).concat(`${m}
${p}
${C}`).concat(h.slice(x))})}))}),t(n),n})()]}function be(r){const e=[];let t=!1,n="";for(let i=0;i<r.length;i++){const s=r.charAt(i);s==='"'&&(t=!t),!t&&s===","?(e.push(n),n=""):n+=s}return e}const me=wt(void 0);function oe(r){const e=me.get();me.set(typeof r=="function"?r(e):r)}class Nt extends Error{code;constructor(e){super("error when parsing markdown text"),this.code=e}}function Lt(r){const e={text:"",url:""};if(r==="")return e;const t=ut(r).trim(),n=document.createElement("div");n.innerHTML=t;const i=n.childNodes.item(0);if(i.childNodes.length>1)throw new Nt(0);switch(i.firstChild?.nodeName){case"#text":{ke(i.innerText)?e.url=i.innerText:e.text=i.innerText;break}case"A":{const l=i.firstChild,f=l.childNodes.item(0).nodeValue||"";e.text=_e(f)===_e(l.href)?"":f,e.url=l.href;break}}return e.url.endsWith("/")&&!r.includes(e.url)&&(e.url=_e(e.url)),e}function Dt(r,e=""){if(ke(e))return r===""?e:`[${r}](${e})`}function ke(r){let e;try{e=new URL(r)}catch{}return e!==void 0}function _e(r){return r.endsWith("/")?r.slice(0,-1):r}const Ft=Y('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"></path></svg>');function $t(r){return z(Ft)}const kt=Y('<div role="presentation" class="modal-root flex flex-col justify-center items-center"><div aria-hidden="true" class="modal-backdrop"></div><div tabindex="-1"></div></div>');function Bt(r){return b(ot,{get when(){return r.isVisible},get children(){return b(tt,{get children(){const e=z(kt),t=e.firstChild,n=t.nextSibling;return rt(t,"click",r.onClose,!0),k(n,()=>r.children),Z(i=>{const s=xt(r.className,"bg-slate-100 z-20 rounded"),o=r.modalStyle;return s!==i._v$&&nt(n,i._v$=s),i._v$2=it(n,o,i._v$2),i},{_v$:void 0,_v$2:void 0}),$e(),e}})}})}Fe(["click"]);const Ut=Y('<form class="flex flex-col gap-2 p-4 pb-6"><h3 class="font-medium">Insert link</h3><div class="flex flex-col justify-center items-start text-sm gap-1"><label for="link-modal--text">Text</label><input class="block w-full" name="text" id="link-modal--text"></div><div class="flex flex-col justify-center items-start text-sm gap-1"><label for="link-modal--url">URL</label><input class="block w-full" name="url" id="link-modal--url"></div><!#><!/></form>'),Mt="link-modal--text";function Pt({textAreaElement:r}){const e=ie(me),t=i=>{i.preventDefault();const s=new FormData(i.currentTarget),o=r();if(!o)return;const{selectionStart:l,selectionEnd:u}=o,f=o.value,h=s.get("text")?.toString()||"",c=s.get("url")?.toString()||"",x=Ht({text:h,url:c}),y=f.slice(0,l).concat(x).concat(f.slice(u));V(y),oe(void 0),o.focus(),o.setSelectionRange(l,l+x.length)};function n(){const i=r();if(!i)return;const{selectionStart:s,selectionEnd:o}=i;Be({markdown:i.value,selection:[s,o]})}return[b(G,{variant:"primary",class:"w-8 h-full",size:"sm",get title(){return W(U.AddOrRemoveLink)},onClick:n,get children(){return b($t,{class:"w-4 h-4"})}}),b(Bt,{get isVisible(){return e()!==void 0},onClose:()=>oe(void 0),get children(){return b(Vt,{get children(){const i=z(Ut),s=i.firstChild,o=s.nextSibling,l=o.firstChild,u=l.nextSibling,f=o.nextSibling,h=f.firstChild,c=h.nextSibling,x=f.nextSibling,[y,m]=q(x.nextSibling);return i.addEventListener("submit",t),k(i,b(G,{class:"mt-4",variant:"primary",type:"submit",children:"Update Link"}),y,m),Z(()=>u.value=e()?.text||""),Z(()=>c.value=e()?.url||""),i}})}})]}function Vt({children:r}){function e(t){t.code==="Escape"&&oe(void 0)}return De(()=>{window.addEventListener("keydown",e);const t=document.getElementById(Mt);t&&t.focus()}),st(()=>window.removeEventListener("keydown",e)),r}function Be({selection:r,markdown:e}){if(!r)return;const t=Lt(e.slice(r[0],r[1]));oe(t)}function Ht({text:r,url:e}){return r&&e?`[${r}](${e})`:r||e}const zt=Y('<div class="flex space-x-1"><!#><!/><!#><!/><!#><!/><!#><!/><!#><!/></div>');function Yt({setSelected:r,textAreaElement:e}){const t=n=>{const i=n.currentTarget.dataset.action,s=e();if(s){const o=pe({action:i,selected:[s.selectionStart,s.selectionEnd],textAreaValue:s.value});r(o.selected),V(o.markdown),s.setSelectionRange(o.selected[0],o.selected[1]),s.focus()}};return(()=>{const n=z(zt),i=n.firstChild,[s,o]=q(i.nextSibling),l=s.nextSibling,[u,f]=q(l.nextSibling),h=u.nextSibling,[c,x]=q(h.nextSibling),y=c.nextSibling,[m,p]=q(y.nextSibling),C=m.nextSibling,[E,d]=q(C.nextSibling);return k(n,b(G,{variant:"primary",size:"sm",class:"w-8",get title(){return W(U.Bold)},onClick:t,get["data-action"](){return F.TOGGLE_BOLD},children:"B"}),s,o),k(n,b(G,{variant:"primary",size:"sm",class:"w-8",get title(){return W(U.Italic)},onClick:t,get["data-action"](){return F.TOGGLE_ITALIC},children:"I"}),u,f),k(n,b(vt,{onClick:t}),c,x),k(n,b(Ot,{textAreaElement:e}),m,p),k(n,b(Pt,{textAreaElement:e}),E,d),n})()}function pe({action:r,textAreaValue:e,selected:t}){if(!t)return{selected:[0,0],markdown:e};const[n,i]=t,s=Et({action:r,textAreaValue:e,selectionEnd:i,selectionStart:n});return{selected:s.selected,markdown:s.text}}var ve=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},M=[],L=[],qt=typeof Uint8Array<"u"?Uint8Array:Array,we=!1;function Ue(){we=!0;for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=r.length;e<t;++e)M[e]=r[e],L[r.charCodeAt(e)]=e;L["-".charCodeAt(0)]=62,L["_".charCodeAt(0)]=63}function Jt(r){we||Ue();var e,t,n,i,s,o,l=r.length;if(l%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=r[l-2]==="="?2:r[l-1]==="="?1:0,o=new qt(l*3/4-s),n=s>0?l-4:l;var u=0;for(e=0,t=0;e<n;e+=4,t+=3)i=L[r.charCodeAt(e)]<<18|L[r.charCodeAt(e+1)]<<12|L[r.charCodeAt(e+2)]<<6|L[r.charCodeAt(e+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=i&255;return s===2?(i=L[r.charCodeAt(e)]<<2|L[r.charCodeAt(e+1)]>>4,o[u++]=i&255):s===1&&(i=L[r.charCodeAt(e)]<<10|L[r.charCodeAt(e+1)]<<4|L[r.charCodeAt(e+2)]>>2,o[u++]=i>>8&255,o[u++]=i&255),o}function Gt(r){return M[r>>18&63]+M[r>>12&63]+M[r>>6&63]+M[r&63]}function jt(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16)+(r[s+1]<<8)+r[s+2],i.push(Gt(n));return i.join("")}function Ae(r){we||Ue();for(var e,t=r.length,n=t%3,i="",s=[],o=16383,l=0,u=t-n;l<u;l+=o)s.push(jt(r,l,l+o>u?u:l+o));return n===1?(e=r[t-1],i+=M[e>>2],i+=M[e<<4&63],i+="=="):n===2&&(e=(r[t-2]<<8)+r[t-1],i+=M[e>>10],i+=M[e>>4&63],i+=M[e<<2&63],i+="="),s.push(i),s.join("")}function ae(r,e,t,n,i){var s,o,l=i*8-n-1,u=(1<<l)-1,f=u>>1,h=-7,c=t?i-1:0,x=t?-1:1,y=r[e+c];for(c+=x,s=y&(1<<-h)-1,y>>=-h,h+=l;h>0;s=s*256+r[e+c],c+=x,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+c],c+=x,h-=8);if(s===0)s=1-f;else{if(s===u)return o?NaN:(y?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-f}return(y?-1:1)*o*Math.pow(2,s-n)}function Me(r,e,t,n,i,s){var o,l,u,f=s*8-i-1,h=(1<<f)-1,c=h>>1,x=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=n?0:s-1,m=n?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+c>=1?e+=x/u:e+=x*Math.pow(2,1-c),e*u>=2&&(o++,u/=2),o+c>=h?(l=0,o=h):o+c>=1?(l=(e*u-1)*Math.pow(2,i),o=o+c):(l=e*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;r[t+y]=l&255,y+=m,l/=256,i-=8);for(o=o<<i|l,f+=i;f>0;r[t+y]=o&255,y+=m,o/=256,f-=8);r[t+y-m]|=p*128}var Qt={}.toString,Pe=Array.isArray||function(r){return Qt.call(r)=="[object Array]"},Wt=50;a.TYPED_ARRAY_SUPPORT=ve.TYPED_ARRAY_SUPPORT!==void 0?ve.TYPED_ARRAY_SUPPORT:!0;se();function se(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function H(r,e){if(se()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(r=new Uint8Array(e),r.__proto__=a.prototype):(r===null&&(r=new a(e)),r.length=e),r}function a(r,e,t){if(!a.TYPED_ARRAY_SUPPORT&&!(this instanceof a))return new a(r,e,t);if(typeof r=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return xe(this,r)}return Ve(this,r,e,t)}a.poolSize=8192;a._augment=function(r){return r.__proto__=a.prototype,r};function Ve(r,e,t,n){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?Zt(r,e,t,n):typeof e=="string"?Xt(r,e,t):er(r,e)}a.from=function(r,e,t){return Ve(null,r,e,t)};a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&a[Symbol.species]);function He(r){if(typeof r!="number")throw new TypeError('"size" argument must be a number');if(r<0)throw new RangeError('"size" argument must not be negative')}function Kt(r,e,t,n){return He(e),e<=0?H(r,e):t!==void 0?typeof n=="string"?H(r,e).fill(t,n):H(r,e).fill(t):H(r,e)}a.alloc=function(r,e,t){return Kt(null,r,e,t)};function xe(r,e){if(He(e),r=H(r,e<0?0:ye(e)|0),!a.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)r[t]=0;return r}a.allocUnsafe=function(r){return xe(null,r)};a.allocUnsafeSlow=function(r){return xe(null,r)};function Xt(r,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!a.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=ze(e,t)|0;r=H(r,n);var i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}function ge(r,e){var t=e.length<0?0:ye(e.length)|0;r=H(r,t);for(var n=0;n<t;n+=1)r[n]=e[n]&255;return r}function Zt(r,e,t,n){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");return t===void 0&&n===void 0?e=new Uint8Array(e):n===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,n),a.TYPED_ARRAY_SUPPORT?(r=e,r.__proto__=a.prototype):r=ge(r,e),r}function er(r,e){if(P(e)){var t=ye(e.length)|0;return r=H(r,t),r.length===0||e.copy(r,0,0,t),r}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||xr(e.length)?H(r,0):ge(r,e);if(e.type==="Buffer"&&Pe(e.data))return ge(r,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function ye(r){if(r>=se())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+se().toString(16)+" bytes");return r|0}a.isBuffer=D;function P(r){return!!(r!=null&&r._isBuffer)}a.compare=function(e,t){if(!P(e)||!P(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};a.concat=function(e,t){if(!Pe(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return a.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=a.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){var o=e[n];if(!P(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,s),s+=o.length}return i};function ze(r,e){if(P(r))return r.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(r)||r instanceof ArrayBuffer))return r.byteLength;typeof r!="string"&&(r=""+r);var t=r.length;if(t===0)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return le(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return We(r).length;default:if(n)return le(r).length;e=(""+e).toLowerCase(),n=!0}}a.byteLength=ze;function tr(r,e,t){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return cr(this,e,t);case"utf8":case"utf-8":return Je(this,e,t);case"ascii":return ur(this,e,t);case"latin1":case"binary":return fr(this,e,t);case"base64":return lr(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return hr(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}a.prototype._isBuffer=!0;function j(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}a.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)j(this,t,t+1);return this};a.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)j(this,t,t+3),j(this,t+1,t+2);return this};a.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)j(this,t,t+7),j(this,t+1,t+6),j(this,t+2,t+5),j(this,t+3,t+4);return this};a.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?Je(this,0,e):tr.apply(this,arguments)};a.prototype.equals=function(e){if(!P(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:a.compare(this,e)===0};a.prototype.inspect=function(){var e="",t=Wt;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"};a.prototype.compare=function(e,t,n,i,s){if(!P(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;for(var o=s-i,l=n-t,u=Math.min(o,l),f=this.slice(i,s),h=e.slice(t,n),c=0;c<u;++c)if(f[c]!==h[c]){o=f[c],l=h[c];break}return o<l?-1:l<o?1:0};function Ye(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=a.from(e,n)),P(e))return e.length===0?-1:Te(r,e,t,n,i);if(typeof e=="number")return e=e&255,a.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Te(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function Te(r,e,t,n,i){var s=1,o=r.length,l=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,l/=2,t/=2}function u(y,m){return s===1?y[m]:y.readUInt16BE(m*s)}var f;if(i){var h=-1;for(f=t;f<o;f++)if(u(r,f)===u(e,h===-1?0:f-h)){if(h===-1&&(h=f),f-h+1===l)return h*s}else h!==-1&&(f-=f-h),h=-1}else for(t+l>o&&(t=o-l),f=t;f>=0;f--){for(var c=!0,x=0;x<l;x++)if(u(r,f+x)!==u(e,x)){c=!1;break}if(c)return f}return-1}a.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};a.prototype.indexOf=function(e,t,n){return Ye(this,e,t,n,!0)};a.prototype.lastIndexOf=function(e,t,n){return Ye(this,e,t,n,!1)};function rr(r,e,t,n){t=Number(t)||0;var i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;var s=e.length;if(s%2!==0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var l=parseInt(e.substr(o*2,2),16);if(isNaN(l))return o;r[t+o]=l}return o}function nr(r,e,t,n){return ce(le(e,r.length-t),r,t,n)}function qe(r,e,t,n){return ce(gr(e),r,t,n)}function ir(r,e,t,n){return qe(r,e,t,n)}function or(r,e,t,n){return ce(We(e),r,t,n)}function sr(r,e,t,n){return ce(wr(e,r.length-t),r,t,n)}a.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(n)?(n=n|0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return rr(this,e,t,n);case"utf8":case"utf-8":return nr(this,e,t,n);case"ascii":return qe(this,e,t,n);case"latin1":case"binary":return ir(this,e,t,n);case"base64":return or(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return sr(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function lr(r,e,t){return e===0&&t===r.length?Ae(r):Ae(r.slice(e,t))}function Je(r,e,t){t=Math.min(r.length,t);for(var n=[],i=e;i<t;){var s=r[i],o=null,l=s>239?4:s>223?3:s>191?2:1;if(i+l<=t){var u,f,h,c;switch(l){case 1:s<128&&(o=s);break;case 2:u=r[i+1],(u&192)===128&&(c=(s&31)<<6|u&63,c>127&&(o=c));break;case 3:u=r[i+1],f=r[i+2],(u&192)===128&&(f&192)===128&&(c=(s&15)<<12|(u&63)<<6|f&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:u=r[i+1],f=r[i+2],h=r[i+3],(u&192)===128&&(f&192)===128&&(h&192)===128&&(c=(s&15)<<18|(u&63)<<12|(f&63)<<6|h&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,l=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=l}return ar(n)}var Re=4096;function ar(r){var e=r.length;if(e<=Re)return String.fromCharCode.apply(String,r);for(var t="",n=0;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Re));return t}function ur(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function fr(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function cr(r,e,t){var n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);for(var i="",s=e;s<t;++s)i+=pr(r[s]);return i}function hr(r,e,t){for(var n=r.slice(e,t),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(a.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=a.prototype;else{var s=t-e;i=new a(s,void 0);for(var o=0;o<s;++o)i[o]=this[o+e]}return i};function v(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUIntLE=function(e,t,n){e=e|0,t=t|0,n||v(e,t,this.length);for(var i=this[e],s=1,o=0;++o<t&&(s*=256);)i+=this[e+o]*s;return i};a.prototype.readUIntBE=function(e,t,n){e=e|0,t=t|0,n||v(e,t,this.length);for(var i=this[e+--t],s=1;t>0&&(s*=256);)i+=this[e+--t]*s;return i};a.prototype.readUInt8=function(e,t){return t||v(e,1,this.length),this[e]};a.prototype.readUInt16LE=function(e,t){return t||v(e,2,this.length),this[e]|this[e+1]<<8};a.prototype.readUInt16BE=function(e,t){return t||v(e,2,this.length),this[e]<<8|this[e+1]};a.prototype.readUInt32LE=function(e,t){return t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};a.prototype.readUInt32BE=function(e,t){return t||v(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};a.prototype.readIntLE=function(e,t,n){e=e|0,t=t|0,n||v(e,t,this.length);for(var i=this[e],s=1,o=0;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};a.prototype.readIntBE=function(e,t,n){e=e|0,t=t|0,n||v(e,t,this.length);for(var i=t,s=1,o=this[e+--i];i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};a.prototype.readInt8=function(e,t){return t||v(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};a.prototype.readInt16LE=function(e,t){t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};a.prototype.readInt16BE=function(e,t){t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};a.prototype.readInt32LE=function(e,t){return t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};a.prototype.readInt32BE=function(e,t){return t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};a.prototype.readFloatLE=function(e,t){return t||v(e,4,this.length),ae(this,e,!0,23,4)};a.prototype.readFloatBE=function(e,t){return t||v(e,4,this.length),ae(this,e,!1,23,4)};a.prototype.readDoubleLE=function(e,t){return t||v(e,8,this.length),ae(this,e,!0,52,8)};a.prototype.readDoubleBE=function(e,t){return t||v(e,8,this.length),ae(this,e,!1,52,8)};function T(r,e,t,n,i,s){if(!P(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}a.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var s=Math.pow(2,8*n)-1;T(this,e,t,n,s,0)}var o=1,l=0;for(this[t]=e&255;++l<n&&(o*=256);)this[t+l]=e/o&255;return t+n};a.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var s=Math.pow(2,8*n)-1;T(this,e,t,n,s,0)}var o=n-1,l=1;for(this[t+o]=e&255;--o>=0&&(l*=256);)this[t+o]=e/l&255;return t+n};a.prototype.writeUInt8=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function ue(r,e,t,n){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(r.length-t,2);i<s;++i)r[t+i]=(e&255<<8*(n?i:1-i))>>>(n?i:1-i)*8}a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):ue(this,e,t,!0),t+2};a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):ue(this,e,t,!1),t+2};function fe(r,e,t,n){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(r.length-t,4);i<s;++i)r[t+i]=e>>>(n?i:3-i)*8&255}a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):fe(this,e,t,!0),t+4};a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):fe(this,e,t,!1),t+4};a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t|0,!i){var s=Math.pow(2,8*n-1);T(this,e,t,n,s-1,-s)}var o=0,l=1,u=0;for(this[t]=e&255;++o<n&&(l*=256);)e<0&&u===0&&this[t+o-1]!==0&&(u=1),this[t+o]=(e/l>>0)-u&255;return t+n};a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t|0,!i){var s=Math.pow(2,8*n-1);T(this,e,t,n,s-1,-s)}var o=n-1,l=1,u=0;for(this[t+o]=e&255;--o>=0&&(l*=256);)e<0&&u===0&&this[t+o+1]!==0&&(u=1),this[t+o]=(e/l>>0)-u&255;return t+n};a.prototype.writeInt8=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1};a.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):ue(this,e,t,!0),t+2};a.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):ue(this,e,t,!1),t+2};a.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):fe(this,e,t,!0),t+4};a.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t|0,n||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):fe(this,e,t,!1),t+4};function Ge(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function je(r,e,t,n,i){return i||Ge(r,e,t,4),Me(r,e,t,n,23,4),t+4}a.prototype.writeFloatLE=function(e,t,n){return je(this,e,t,!0,n)};a.prototype.writeFloatBE=function(e,t,n){return je(this,e,t,!1,n)};function Qe(r,e,t,n,i){return i||Ge(r,e,t,8),Me(r,e,t,n,52,8),t+8}a.prototype.writeDoubleLE=function(e,t,n){return Qe(this,e,t,!0,n)};a.prototype.writeDoubleBE=function(e,t,n){return Qe(this,e,t,!1,n)};a.prototype.copy=function(e,t,n,i){if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s=i-n,o;if(this===e&&n<t&&t<i)for(o=s-1;o>=0;--o)e[o+t]=this[o+n];else if(s<1e3||!a.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s};a.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),e.length===1){var s=e.charCodeAt(0);s<256&&(e=s)}if(i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var o;if(typeof e=="number")for(o=t;o<n;++o)this[o]=e;else{var l=P(e)?e:le(new a(e,i).toString()),u=l.length;for(o=0;o<n-t;++o)this[o+t]=l[o%u]}return this};var dr=/[^+\/0-9A-Za-z-_]/g;function _r(r){if(r=mr(r).replace(dr,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function mr(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function pr(r){return r<16?"0"+r.toString(16):r.toString(16)}function le(r,e){e=e||1/0;for(var t,n=r.length,i=null,s=[],o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function gr(r){for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function wr(r,e){for(var t,n,i,s=[],o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function We(r){return Jt(_r(r))}function ce(r,e,t,n){for(var i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function xr(r){return r!==r}function D(r){return r!=null&&(!!r._isBuffer||Ke(r)||yr(r))}function Ke(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function yr(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&Ke(r.slice(0,0))}class I extends Error{constructor(e,t,n,...i){Array.isArray(t)&&(t=t.join(" ")),super(t),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,I),this.code=e;for(const s of i)for(const o in s){const l=s[o];this[o]=D(l)?l.toString(n.encoding):l==null?l:JSON.parse(JSON.stringify(l))}}}const Er=function(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)},Xe=function(r){const e=[];for(let t=0,n=r.length;t<n;t++){const i=r[t];if(i==null||i===!1)e[t]={disabled:!0};else if(typeof i=="string")e[t]={name:i};else if(Er(i)){if(typeof i.name!="string")throw new I("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${t}`,"when column is an object literal"]);e[t]=i}else throw new I("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(i)} at position ${t}`])}return e};class Oe{constructor(e=100){this.size=e,this.length=0,this.buf=a.allocUnsafe(e)}prepend(e){if(D(e)){const t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");const n=this.buf;this.buf=a.allocUnsafe(this.size),e.copy(this.buf,0),n.copy(this.buf,e.length),this.length+=e.length}else{const t=this.length++;t===this.size&&this.resize();const n=this.clone();this.buf[0]=e,n.copy(this.buf,1,0,t)}}append(e){const t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return a.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const t=a.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const Ir=12,Cr=13,Sr=10,br=32,vr=9,Ar=function(r){return{bomSkipped:!1,bufBytesStart:0,castField:r.cast_function,commenting:!1,error:void 0,enabled:r.from_line===1,escaping:!1,escapeIsQuote:D(r.escape)&&D(r.quote)&&a.compare(r.escape,r.quote)===0,expectedRecordLength:Array.isArray(r.columns)?r.columns.length:void 0,field:new Oe(20),firstLineToHeaders:r.cast_first_line_to_header,needMoreDataSize:Math.max(r.comment!==null?r.comment.length:0,...r.delimiter.map(e=>e.length),r.quote!==null?r.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new Oe(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:r.record_delimiter.length===0?0:Math.max(...r.record_delimiter.map(e=>e.length)),trimChars:[a.from(" ",r.encoding)[0],a.from("	",r.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[a.from(a.from([Cr],"utf8").toString(),r.encoding),a.from(a.from([Sr],"utf8").toString(),r.encoding),a.from(a.from([Ir],"utf8").toString(),r.encoding),a.from(a.from([br],"utf8").toString(),r.encoding),a.from(a.from([vr],"utf8").toString(),r.encoding)]}},Tr=function(r){return r.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})},Ne=function(r){const e={};for(const n in r)e[Tr(n)]=r[n];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new I("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new I("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new I("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(n){const i=Date.parse(n);return isNaN(i)?n:new Date(i)};else if(typeof e.cast_date!="function")throw new I("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=Xe(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new I("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new I("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new I("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=a.from(e.comment,e.encoding)),!D(e.comment))throw new I("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);const t=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new I("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);if(e.delimiter=e.delimiter.map(function(n){if(n==null||n===!1)return a.from(",",e.encoding);if(typeof n=="string"&&(n=a.from(n,e.encoding)),!D(n)||n.length===0)throw new I("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);return n}),e.escape===void 0||e.escape===!0?e.escape=a.from('"',e.encoding):typeof e.escape=="string"?e.escape=a.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!D(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(r.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(r.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(r.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new I("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new I("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(D(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new I("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=a.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=a.from(e.quote,e.encoding)),!D(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||D(e.record_delimiter)){if(e.record_delimiter.length===0)throw new I("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new I("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(n,i){if(typeof n!="string"&&!D(n))throw new I("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(n)}`],e);if(n.length===0)throw new I("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(n)}`],e);return typeof n=="string"&&(n=a.from(n,e.encoding)),n}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&r.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&r.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(r.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(r.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(r.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(r.to_line)}`);return e},Le=function(r){return r.every(e=>e==null||e.toString&&e.toString().trim()==="")},Rr=13,Or=10,ne={utf8:a.from([239,187,191]),utf16le:a.from([255,254])},Nr=function(r={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},t=Ne(r);return{info:e,original_options:r,options:t,state:Ar(t),__needMoreData:function(n,i,s){if(s)return!1;const{encoding:o,escape:l,quote:u}=this.options,{quoting:f,needMoreDataSize:h,recordDelimiterMaxLength:c}=this.state,x=i-n-1,y=Math.max(h,c===0?a.from(`\r
`,o).length:c,f?(l===null?0:l.length)+u.length:0,f?u.length+c:0);return x<y},parse:function(n,i,s,o){const{bom:l,from_line:u,ltrim:f,max_record_size:h,raw:c,relax_quotes:x,rtrim:y,skip_empty_lines:m,to:p,to_line:C}=this.options;let{comment:E,escape:d,quote:_,record_delimiter:B}=this.options;const{bomSkipped:he,previousBuf:R,rawBuffer:O,escapeIsQuote:N}=this.state;let w;if(R===void 0)if(n===void 0){o();return}else w=n;else R!==void 0&&n===void 0?w=R:w=a.concat([R,n]);if(he===!1)if(l===!1)this.state.bomSkipped=!0;else if(w.length<3){if(i===!1){this.state.previousBuf=w;return}}else{for(const S in ne)if(ne[S].compare(w,0,ne[S].length)===0){const $=ne[S].length;this.state.bufBytesStart+=$,w=w.slice($),this.options=Ne({...this.original_options,encoding:S}),{comment:E,escape:d,quote:_}=this.options;break}this.state.bomSkipped=!0}const Q=w.length;let g;for(g=0;g<Q&&!this.__needMoreData(g,Q,i);g++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),C!==-1&&this.info.lines>C){this.state.stop=!0,o();return}this.state.quoting===!1&&B.length===0&&this.__autoDiscoverRecordDelimiter(w,g)&&(B=this.options.record_delimiter);const S=w[g];if(c===!0&&O.append(S),(S===Rr||S===Or)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(d!==null&&this.state.quoting===!0&&this.__isEscape(w,g,S)&&g+d.length<Q)if(N){if(this.__isQuote(w,g+d.length)){this.state.escaping=!0,g+=d.length-1;continue}}else{this.state.escaping=!0,g+=d.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(w,g))if(this.state.quoting===!0){const A=w[g+_.length],Ee=y&&this.__isCharTrimable(w,g+_.length),te=E!==null&&this.__compareBytes(E,w,g+_.length,A),K=this.__isDelimiter(w,g+_.length,A),re=B.length===0?this.__autoDiscoverRecordDelimiter(w,g+_.length):this.__isRecordDelimiter(A,w,g+_.length);if(d!==null&&this.__isEscape(w,g,S)&&this.__isQuote(w,g+d.length))g+=d.length-1;else if(!A||K||re||te||Ee){this.state.quoting=!1,this.state.wasQuoting=!0,g+=_.length-1;continue}else if(x===!1){const X=this.__error(new I("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(A)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(X!==void 0)return X}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(_),g+=_.length-1}else if(this.state.field.length!==0){if(x===!1){const A=this.__error(new I("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found inside a field at line ${this.info.lines}`],this.options,this.__infoField(),{field:this.state.field}));if(A!==void 0)return A}}else{this.state.quoting=!0,g+=_.length-1;continue}if(this.state.quoting===!1){const A=this.__isRecordDelimiter(S,w,g);if(A!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=u){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),g+=A-1;continue}if(m===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,g+=A-1;continue}this.info.bytes=this.state.bufBytesStart+g;const re=this.__onField();if(re!==void 0)return re;this.info.bytes=this.state.bufBytesStart+g+A;const X=this.__onRecord(s);if(X!==void 0)return X;if(p!==-1&&this.info.records>=p){this.state.stop=!0,o();return}}this.state.commenting=!1,g+=A-1;continue}if(this.state.commenting)continue;if((E===null?0:this.__compareBytes(E,w,g,S))!==0){this.state.commenting=!0;continue}const te=this.__isDelimiter(w,g,S);if(te!==0){this.info.bytes=this.state.bufBytesStart+g;const K=this.__onField();if(K!==void 0)return K;g+=te-1;continue}}}if(this.state.commenting===!1&&h!==0&&this.state.record_length+this.state.field.length>h)return this.__error(new I("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${h}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const $=f===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(w,g),ee=y===!1||this.state.wasQuoting===!1;if($===!0&&ee===!0)this.state.field.append(S);else{if(y===!0&&!this.__isCharTrimable(w,g))return this.__error(new I("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));$===!1&&(g+=this.__isCharTrimable(w,g)-1);continue}}if(i===!0)if(this.state.quoting===!0){const S=this.__error(new I("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(S!==void 0)return S}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+g;const S=this.__onField();if(S!==void 0)return S;const $=this.__onRecord(s);if($!==void 0)return $}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=g,this.state.previousBuf=w.slice(g);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(n){const{columns:i,group_columns_by_name:s,encoding:o,info:l,from:u,relax_column_count:f,relax_column_count_less:h,relax_column_count_more:c,raw:x,skip_records_with_empty_values:y}=this.options,{enabled:m,record:p}=this.state;if(m===!1)return this.__resetRecord();const C=p.length;if(i===!0){if(y===!0&&Le(p)){this.__resetRecord();return}return this.__firstLineToColumns(p)}if(i===!1&&this.info.records===0&&(this.state.expectedRecordLength=C),C!==this.state.expectedRecordLength){const E=i===!1?new I("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${C} on line ${this.info.lines}`],this.options,this.__infoField(),{record:p}):new I("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${C} on line ${this.info.lines}`],this.options,this.__infoField(),{record:p});if(f===!0||h===!0&&C<this.state.expectedRecordLength||c===!0&&C>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=E;else{const d=this.__error(E);if(d)return d}}if(y===!0&&Le(p)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,u===1||this.info.records>=u){const{objname:E}=this.options;if(i!==!1){const d={};for(let _=0,B=p.length;_<B;_++)i[_]===void 0||i[_].disabled||(s===!0&&d[i[_].name]!==void 0?Array.isArray(d[i[_].name])?d[i[_].name]=d[i[_].name].concat(p[_]):d[i[_].name]=[d[i[_].name],p[_]]:d[i[_].name]=p[_]);if(x===!0||l===!0){const _=Object.assign({record:d},x===!0?{raw:this.state.rawBuffer.toString(o)}:{},l===!0?{info:this.__infoRecord()}:{}),B=this.__push(E===void 0?_:[d[E],_],n);if(B)return B}else{const _=this.__push(E===void 0?d:[d[E],d],n);if(_)return _}}else if(x===!0||l===!0){const d=Object.assign({record:p},x===!0?{raw:this.state.rawBuffer.toString(o)}:{},l===!0?{info:this.__infoRecord()}:{}),_=this.__push(E===void 0?d:[p[E],d],n);if(_)return _}else{const d=this.__push(E===void 0?p:[p[E],p],n);if(d)return d}}this.__resetRecord()},__firstLineToColumns:function(n){const{firstLineToHeaders:i}=this.state;try{const s=i===void 0?n:i.call(null,n);if(!Array.isArray(s))return this.__error(new I("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(s)}`],this.options,this.__infoField(),{headers:s}));const o=Xe(s);this.state.expectedRecordLength=o.length,this.options.columns=o,this.__resetRecord();return}catch(s){return s}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:n,encoding:i,rtrim:s,max_record_size:o}=this.options,{enabled:l,wasQuoting:u}=this.state;if(l===!1)return this.__resetField();let f=this.state.field.toString(i);if(s===!0&&u===!1&&(f=f.trimRight()),n===!0){const[h,c]=this.__cast(f);if(h!==void 0)return h;f=c}this.state.record.push(f),o!==0&&typeof f=="string"&&(this.state.record_length+=f.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(n,i){const{on_record:s}=this.options;if(s!==void 0){const o=this.__infoRecord();try{n=s.call(null,n,o)}catch(l){return l}if(n==null)return}i(n)},__cast:function(n){const{columns:i,relax_column_count:s}=this.options;if(Array.isArray(i)===!0&&s&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const l=this.__infoField();return[void 0,this.state.castField.call(null,n,l)]}catch(l){return[l]}if(this.__isFloat(n))return[void 0,parseFloat(n)];if(this.options.cast_date!==!1){const l=this.__infoField();return[void 0,this.options.cast_date.call(null,n,l)]}return[void 0,n]},__isCharTrimable:function(n,i){return((o,l)=>{const{timchars:u}=this.state;e:for(let f=0;f<u.length;f++){const h=u[f];for(let c=0;c<h.length;c++)if(h[c]!==o[l+c])continue e;return h.length}return 0})(n,i)},__isFloat:function(n){return n-parseFloat(n)+1>=0},__compareBytes:function(n,i,s,o){if(n[0]!==o)return 0;const l=n.length;for(let u=1;u<l;u++)if(n[u]!==i[s+u])return 0;return l},__isDelimiter:function(n,i,s){const{delimiter:o,ignore_last_delimiters:l}=this.options;if(l===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(l!==!1&&typeof l=="number"&&this.state.record.length===l-1)return 0;e:for(let u=0;u<o.length;u++){const f=o[u];if(f[0]===s){for(let h=1;h<f.length;h++)if(f[h]!==n[i+h])continue e;return f.length}}return 0},__isRecordDelimiter:function(n,i,s){const{record_delimiter:o}=this.options,l=o.length;e:for(let u=0;u<l;u++){const f=o[u],h=f.length;if(f[0]===n){for(let c=1;c<h;c++)if(f[c]!==i[s+c])continue e;return f.length}}return 0},__isEscape:function(n,i,s){const{escape:o}=this.options;if(o===null)return!1;const l=o.length;if(o[0]===s){for(let u=0;u<l;u++)if(o[u]!==n[i+u])return!1;return!0}return!1},__isQuote:function(n,i){const{quote:s}=this.options;if(s===null)return!1;const o=s.length;for(let l=0;l<o;l++)if(s[l]!==n[i+l])return!1;return!0},__autoDiscoverRecordDelimiter:function(n,i){const{encoding:s}=this.options,o=[a.from(`\r
`,s),a.from(`
`,s),a.from("\r",s)];e:for(let l=0;l<o.length;l++){const u=o[l].length;for(let f=0;f<u;f++)if(o[l][f]!==n[i+f])continue e;return this.options.record_delimiter.push(o[l]),this.state.recordDelimiterMaxLength=o[l].length,o[l].length}return 0},__error:function(n){const{encoding:i,raw:s,skip_records_with_error:o}=this.options,l=typeof n=="string"?new Error(n):n;if(o){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(l,s?this.state.rawBuffer.toString(i):void 0);return}else return l},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:n,raw:i,encoding:s}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:n===!0,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(s):void 0}},__infoField:function(){const{columns:n}=this.options,i=Array.isArray(n);return{...this.__infoRecord(),column:i===!0?n.length>this.state.record.length?n[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},Lr=function(r,e={}){typeof r=="string"&&(r=a.from(r));const t=e&&e.objname?{}:[],n=Nr(e),i=u=>{n.options.objname===void 0?t.push(u):t[u[0]]=u[1]},s=()=>{},o=n.parse(r,!1,i,s);if(o!==void 0)throw o;const l=n.parse(void 0,!0,i,s);if(l!==void 0)throw l;return t};function Dr(r){if(!r)return;const e=r.trim().split(`
`),t=e.map(i=>i.match(/\t+/g)?.length||0);if(t.every(i=>i===t[0]&&i>0))return e.map(i=>`|${Ze(i).replace(/\t+/g,"|")}|`).join(`
`)}function Fr(r){if(r)try{const e=Lr(r.trim().replace(/[“”]/g,'"'),{skipEmptyLines:!0});return e.length===1&&e[0].length===1?void 0:e.map(t=>`|${t.map(n=>Ze(n)).join("|")}|`).join(`
`)}catch{return}}function Ze(r){return r.replace(/\|/g,"\\|")}const $r=Y('<fieldset class="flex flex-col mt-4 h-full"><div class="flex justify-between"><!#><!/><!#><!/></div><textarea class="markdown-editor"></textarea></fieldset>'),Vr=()=>{const r=ie(ft),e=ie(ct),t=ie(ht),[n,i]=J(void 0),[s,o]=J(void 0),[l,u]=J(void 0),[f,h]=J(!1);lt(m=>{const p=e()?.rawContent;if(m!==void 0&&p!==void 0&&m!==p){const C=s();if(!C)return;const[E,d]=C;o(void 0),V(r().slice(0,E).concat(p).concat(r().slice(d)))}return p},e()?.rawContent);const c=()=>{const m=l();let p=r(),C,E=0,d=0;if(m&&(E=m.selectionStart,d=m.selectionEnd,p=p.slice(E,d),C=mt(p),m.setSelectionRange(0,0)),C===void 0){yt({message:"Cannot inspect element: element is not supported yet for inspection or selections are invalid.",type:"error"});return}pt(C),gt(Ce.InspectingSnippet),o([E,d]),i(void 0)},x=m=>{if(m.key.toLowerCase()==="v"&&m.shiftKey&&de(m)){h(!0);return}const{selectionStart:p,selectionEnd:C}=m.currentTarget;if(m.key==="Tab"&&p===C){m.preventDefault(),V(d=>d.slice(0,p)+"  "+d.slice(p+1)),m.currentTarget.setSelectionRange(p+2,C+2);return}const E=dt(m.key);if(_t(E)&&m.altKey&&de(m)){const d=F[`TOOLBAR_HEADING_${E}`];if(d){const _=pe({action:d,selected:[p,C],textAreaValue:r()});i(_.selected),V(_.markdown),l()?.setSelectionRange(_.selected[0],_.selected[1])}}else if(de(m)){let d;switch(m.key){case"b":{m.preventDefault(),d=F.TOGGLE_BOLD;break}case"i":{m.preventDefault(),d=F.TOGGLE_ITALIC;break}case"`":{m.preventDefault(),c();break}case"k":{m.preventDefault();const _=l();if(!_)return;Be({selection:[_.selectionStart,_.selectionEnd],markdown:r()});break}}if(d){const _=pe({action:d,selected:n(),textAreaValue:r()});i(_.selected),V(_.markdown),l()?.setSelectionRange(_.selected[0],_.selected[1])}}};function y(){const m=n();return m?m[0]===m[1]:!0}return(()=>{const m=z($r),p=m.firstChild,C=p.firstChild,[E,d]=q(C.nextSibling),_=E.nextSibling,[B,he]=q(_.nextSibling),R=p.nextSibling;return k(p,b(Yt,{setSelected:i,textAreaElement:l}),E,d),k(p,b(G,{variant:"primary",size:"sm",isDisabled:y,get title(){return W(U.Inspect)},onClick:c,children:"Inspect Element"}),B,he),R.addEventListener("paste",O=>{if(f()){h(!1);return}const N=O.clipboardData?.getData("text/plain")||"",{selectionStart:w,selectionEnd:Q,value:g}=O.currentTarget,S=kr(N,[()=>Dt(g.slice(w,Q),N),Dr,Fr]);if(S){O.preventDefault(),V(ee=>ee.slice(0,w).concat(S).concat(ee.slice(Q)));const $=w+S.length;O.currentTarget.setSelectionRange($,$)}}),R.$$input=O=>{const N=O.currentTarget.value??"";V(N)},R.$$click=O=>{const{selectionStart:N,selectionEnd:w}=O.currentTarget;i(N===w?void 0:[N,w])},R.$$keyup=O=>{const{selectionStart:N,selectionEnd:w}=O.currentTarget;i(N===w?void 0:[N,w])},R.$$keydown=x,u(R),Z(()=>m.disabled=t()===Ce.InspectingSnippet),Z(()=>R.value=r()),$e(),m})()};function kr(r,e){let t;for(const n of e)if(t=n(r),t)break;return t}Fe(["keydown","keyup","click","input"]);export{Vr as MarkdownEditor};
